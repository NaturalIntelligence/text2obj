var version=function(){"use strict";function t(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var e,n,i,s;return t(function(){if(s)return i;s=1;const t=function(){if(n)return e;n=1;const t=["IF","ELSE_IF","ELSE","LOOP"],i=["GOTO","SKIP","STOP","END"];function s(e){return t.includes(e.type)}function r(t){return i.includes(t.type)}function o(t,e,n){let i=-2;if(void 0!==n){const s=t[n],r=t[e].indent;for(let o=e+1;o<t.length;o++){const e=t[o].indent;if(e===r){i=o;break}if(e<r){i=e>s.indent?o:n;break}}-2===i&&(i=n)}else{for(let n=e+1;n<t.length;n++)if(t[n].indent<=t[e].indent){i=n;break}-2===i&&(i=-1)}return i>-1&&t[i].type.startsWith("ELSE")&&(t[e].indent!==t[i].indent||"IF"!==t[e].type&&"ELSE_IF"!==t[e].type)&&(i=o(t,i,n)),i}function f(t,e,n,i){const s=o(t,e,a(i));n[e].push(s)}function u(t,e){const n=t[e].indent;for(let i=e-1;i>-1;i--)if(n===t[i].indent)return i;throw new Error("Unable to find last step of same indent level")}function l(t,e,n,i,s){if("ELSE"===t.type)return void delete n[i];const r=t.indent;e[i+1]&&e[i+1].indent>r?n[i].push(i+1):n[i].push(void 0);let f=o(e,i,a(s));-1!==f&&"ELSE"===e[f].type&&f++,n[i].push(f),"LOOP"===t.type&&s.push(i)}function c(t,e){if(0===e)throw new Error(`${t[e].type} can't be first step of the flow`)}function d(t,e,n,i,s){if(c(t,s),void 0===n[e.msg])throw new Error(`GOTO is pointing to ${e.msg} that doesn't specified with any step`);h(t,i,s,n[e.msg])}function p(t,e,n,i){c(t,e);const s=t[e];if("SKIP"===s.type){if(i.length<1)throw new Error("SKIP must be inside LOOP");h(t,n,e,i[i.length-1])}else if("STOP"===s.type){if(i.length<1)throw new Error("STOP must be inside LOOP");h(t,n,e,o(t,a(i)))}else"END"===s.type&&h(t,n,e,-1)}function h(t,e,n,i){for(let s=0;s<n;s++){let r=e[s];if(void 0!==r){const e=r.indexOf(n);-1!==e&&("ELSE"===t[s].type&&(r=u(t,r)),r[e]=i)}}delete e[n]}function a(t){return t[t.length-1]}return e=function(t,e,n){const i=[];for(let o=0;o<t.length;o++){const u=t[o],c=u.indent;if(i.length>0)for(let e=i.length-1;e>-1;e--)c<=t[i[e]].indent&&i.pop();"GOTO"===u.type?d(t,u,e,n,o):s(u)?l(u,t,n,o,i):r(u)?p(t,o,n,i):f(t,o,n,i)}}}(),r=["IF","ELSE_IF","LOOP","ELSE"],o=["GOTO","SKIP","STOP","END"],f=["AND","THEN","BUT","FOLLOW","ERR"];class u{constructor(t){this.name=t,this.headers={},this.steps=[],this.links={},this.leveledSteps=[[]]}}function l(t){return t.replace(/\([^)]*\)/g,"").replace(/\s\s/g," ")}function c(t){return-1!==o.indexOf(t)||-1!==r.indexOf(t)||-1!==f.indexOf(t)}return i=function(e){const n=e.split("\n"),i=[];let s={},r=[],o=0,f=-1,d=null,p=!1;return n.forEach(((e,n)=>{const h=e.trim();if(!h||"#"===h[0])return;if(h.startsWith("FLOW:"))return d&&t(d.steps,s,d.links),s={},r=[],o=0,f=-1,d=new u(h.substring(6)),i.push(d),void(p=!0);if(p&&h.match(/^[a-z]{1,70}:/)){const[t,n]=e.split(":");return void(d.headers[t.trim()]=n.trim())}p=!1,f++;const a=e.search(/\S/);let O;if(void 0!==r[o]?O=r[o]:(O=a,r[o]=a),O===a)d.leveledSteps[o].push(f);else if(O<a)r[++o]=a,d.leveledSteps[o]?d.leveledSteps[o].push(f):d.leveledSteps.push([f]);else{for(;o>-1;o--){if(r[o]===a)break}if(-1===o)throw new Error(`Indentation issue with line |${e}|`);d.leveledSteps[o].push(f)}let E=function(t){const e={msg:"",rawMsg:"",type:""};if("["===t[0]){const n=t.indexOf("]");e.index=t.substring(1,n).trim(),t=t.substring(n+1).trimStart()}const n=t.indexOf(" ");if(n<1)c(t)?e.type=t:e.msg=e.rawMsg=t;else{const i=t.substring(0,n),s=t.substring(n+1);c(i)?(e.type=i,e.rawMsg=s,e.msg=l(s).trim()):(e.rawMsg=t,e.msg=l(t))}return e}(e.trim());E.indent=o,E.index&&(s[E.index]=f),d.steps.push(E),d.links[f]=[]})),t(d.steps,s,d.links),i}}())}();
